import { Tab, Tabs } from 'rspress/theme';
import { PackageManagerTabs } from '@theme';


# Quick Start: Initialize Supabase with `hot-updater`

This guide walks you through setting up `hot-updater` with Supabase in a React Native project. You'll configure the environment, install required packages, and initialize Supabase for seamless updates.

## Prerequisites

Before starting, ensure you have the following:
- **Node.js** (v20 or higher recommended)
- Supabase CLI (`npx supabase`)
- Supabase Account

## Step 1: Install Required Packages

Run the following command to install dependencies:

<PackageManagerTabs command={
  {
    npm: "npm install hot-updater --save-dev",
    pnpm: "pnpm add hot-updater -D",
    yarn: "yarn add hot-updater -D",
  }
} />

## Step 2: Run the Initialization Script

Run the init function to start the interactive setup process:

<PackageManagerTabs command={
  {
    npm: "npm run hot-updater init",
    pnpm: "pnpm hot-updater init",
    yarn: "yarn hot-updater init",
  }
} />

Youâ€™ll be prompted to:
-	Select a Build Plugin (e.g., Metro)
-	Select a Provider (e.g., Supabase)

## Step 4: Configure Supabase
During the setup, youâ€™ll:
1.	Create or select a Supabase Organization.
2.	Create or select a Project.
3.	Choose a Storage Bucket or create a new public bucket.

Follow the prompts to complete each step.


After initialization, a `.env` file will be generated with the following keys:

```
HOT_UPDATER_SUPABASE_ANON_KEY=your-anon-key
HOT_UPDATER_SUPABASE_BUCKET_NAME=your-bucket-name
HOT_UPDATER_SUPABASE_URL=https://your-project-id.supabase.co
```

Ensure these variables are correctly set in your environment.

## Step 6: Deploy Edge Functions

The script automatically deploys a Supabase edge function (update-server). Verify its deployment in your Supabase dashboard under the Edge Functions section.

## Step 7: Generated Configurations

The script generates the following files:
- hot-updater.config.ts: Contains your Supabase integration settings.

Example snippet from `hot-updater.config.ts`:
```ts title=hot-updater.config.ts
import { metro } from "@hot-updater/metro";
import { supabaseDatabase, supabaseStorage } from "@hot-updater/supabase";
import { defineConfig } from "hot-updater";
import "dotenv/config";

export default defineConfig({
  build: metro(),
  storage: supabaseStorage({
    supabaseUrl: process.env.HOT_UPDATER_SUPABASE_URL!,
    supabaseAnonKey: process.env.HOT_UPDATER_SUPABASE_ANON_KEY!,
    bucketName: process.env.HOT_UPDATER_SUPABASE_BUCKET_NAME!,
  }),
  database: supabaseDatabase({
    supabaseUrl: process.env.HOT_UPDATER_SUPABASE_URL!,
    supabaseAnonKey: process.env.HOT_UPDATER_SUPABASE_ANON_KEY!,
  }),
});
```

## Step 8: Add HotUpdater to Your Project
```tsx title=App.tsx
import { HotUpdater } from "@hot-updater/react-native";

function App() {
  return (
    <View>
      <Text>Hello World</Text>
    </View>
  );
}

export default HotUpdater.wrap({ 
  source: "https://<project-id>.supabase.co/functions/v1/update-server",
  fallbackComponent: ({ progress = 0 }) => (
    <Modal transparent visible={true}>
      <View
        style={{
          flex: 1,
          padding: 20,
          borderRadius: 10,
          justifyContent: "center",
          alignItems: "center",
          backgroundColor: "rgba(0, 0, 0, 0.5)",
        }}
      >
        <Text style={{ color: "white", fontSize: 20, fontWeight: "bold" }}>
          Updating...
        </Text>
        <Text style={{ color: "white", fontSize: 20, fontWeight: "bold" }}>
          {Math.round(progress * 100)}%
        </Text>
      </View>
    </Modal>
  ),
})(App);

```

## Step 9: Add Native Code

 
<Tabs>
    <Tab label="Kotlin">
```kt title=android/app/src/main/java/com/<your-app-name>/MainActivity.kt
package com.hotupdaterexample

import android.app.Application
import android.util.Log
import com.facebook.react.PackageList
import com.facebook.react.ReactApplication
import com.facebook.react.ReactHost
import com.facebook.react.ReactNativeHost
import com.facebook.react.ReactPackage
import com.facebook.react.defaults.DefaultNewArchitectureEntryPoint.load
import com.facebook.react.defaults.DefaultReactHost.getDefaultReactHost
import com.facebook.react.defaults.DefaultReactNativeHost
import com.facebook.react.soloader.OpenSourceMergedSoMapping
import com.facebook.soloader.SoLoader
import com.hotupdater.HotUpdater // [!code ++]

class MainApplication :
    Application(),
    ReactApplication {
    override val reactNativeHost: ReactNativeHost =
        object : DefaultReactNativeHost(this) {
            override fun getPackages(): List<ReactPackage> =
                PackageList(this).packages.apply {
                    // Packages that cannot be autolinked yet can be added manually here, for example:
                    // add(MyReactNativePackage())
                }

            override fun getJSMainModuleName(): String = "index"

            override fun getUseDeveloperSupport(): Boolean = BuildConfig.DEBUG

            override val isNewArchEnabled: Boolean = BuildConfig.IS_NEW_ARCHITECTURE_ENABLED
            override val isHermesEnabled: Boolean = BuildConfig.IS_HERMES_ENABLED

            override fun getJSBundleFile(): String? {  // [!code ++]
                return HotUpdater.getJSBundleFile(applicationContext)  // [!code ++]
            }  // [!code ++]
        }
    
    override val reactHost: ReactHost
              get() = getDefaultReactHost(applicationContext, reactNativeHost)

    override fun onCreate() {
        super.onCreate()
        SoLoader.init(this, OpenSourceMergedSoMapping)

        if (BuildConfig.IS_NEW_ARCHITECTURE_ENABLED) {
            // If you opted-in for the New Architecture, we load the native entry point for this app.
            load()
        }
    }
}
```

</Tab>
    <Tab label="Java">
  ```java title=android/app/src/main/java/com/<your-app-name>/MainActivity.java

package com.hotupdaterexample;

import android.app.Application;
import com.facebook.react.PackageList;
import com.facebook.react.ReactApplication;
import com.facebook.react.ReactNativeHost;
import com.facebook.react.ReactPackage;
import com.facebook.react.defaults.DefaultNewArchitectureEntryPoint;
import com.facebook.react.defaults.DefaultReactNativeHost;
import com.facebook.soloader.SoLoader;
import java.util.List;
import com.hotupdater.HotUpdater;  // [!code ++]

public class MainApplication extends Application implements ReactApplication {

  private final ReactNativeHost mReactNativeHost =
      new DefaultReactNativeHost(this) {
        @Override
        public boolean getUseDeveloperSupport() {
          return BuildConfig.DEBUG;
        }

        @Override
        protected List<ReactPackage> getPackages() {
          @SuppressWarnings("UnnecessaryLocalVariable")
          List<ReactPackage> packages = new PackageList(this).getPackages();
          // Packages that cannot be autolinked yet can be added manually here, for example:
          return packages;
        }

        @Override
        protected String getJSMainModuleName() {
          return "index";
        }
        
        @Override // [!code ++]
        protected String getJSBundleFile() {  // [!code ++]
            return HotUpdater.Companion.getJSBundleFile(this.getApplication().getApplicationContext());  // [!code ++]
        }  // [!code ++]

        @Override
        protected boolean isNewArchEnabled() {
          return BuildConfig.IS_NEW_ARCHITECTURE_ENABLED;
        }

        @Override
        protected Boolean isHermesEnabled() {
          return BuildConfig.IS_HERMES_ENABLED;
        }
      };

  @Override
  public ReactNativeHost getReactNativeHost() {
    return mReactNativeHost;
  }

  @Override
  public void onCreate() {
    super.onCreate();
    SoLoader.init(this, /* native exopackage */ false);
    
    if (BuildConfig.IS_NEW_ARCHITECTURE_ENABLED) {
      // If you opted-in for the New Architecture, we load the native entry point for this app.
      DefaultNewArchitectureEntryPoint.load();
    }
    ReactNativeFlipper.initializeFlipper(this, getReactNativeHost().getReactInstanceManager());
  }
}

```  
  </Tab>
</Tabs>



```objc title=ios/<your-app-name>/AppDelegate.mm
#import "AppDelegate.h"
#import <HotUpdater/HotUpdater.h> // [!code ++]
#import <React/RCTBundleURLProvider.h>

@implementation AppDelegate

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  self.moduleName = @"HotUpdaterExample";
  // You can add your custom initial props in the dictionary below.
  // They will be passed down to the ViewController used by React Native.
  self.initialProps = @{};

  return [super application:application didFinishLaunchingWithOptions:launchOptions];
}

- (NSURL *)sourceURLForBridge:(RCTBridge *)bridge
{
  return [self bundleURL];
}

- (NSURL *)bundleURL
{
// [!code ++:2]
  return [HotUpdater bundleURL];  
}

@end
```


## Verifying the Setup
1. Check your Supabase dashboard for the newly created bucket and edge function.
2. Test the HotUpdater integration in your React Native app.


Youâ€™re all set! ðŸŽ‰ Start using hot-updater with Supabase for seamless updates in your React Native app.

This document simplifies the initialization process, making it easy for developers to get started with minimal friction.